@inherits LayoutComponentBase
@inject JournalApp.Services.AuthService Auth
@inject JournalApp.Services.ThemeService ThemeService
@inject IJSRuntime JS

@if (!_authReady)
{
    <div class="d-flex justify-content-center align-items-center vh-100">
        <div class="text-muted">Loading...</div>
    </div>
}
else if (!Auth.HasAccount)
{
    <div class="d-flex justify-content-center align-items-center vh-100">
        <JournalApp.Components.Pages.SetupPin />
    </div>
}
else if (!Auth.IsLoggedIn)
{
    <!-- LOGIN FIRST -->
    <div class="d-flex justify-content-center align-items-center vh-100">
        <JournalApp.Components.Pages.Login />
    </div>
}
else
{
    <!-- MAIN APPLICATION -->
    <div class="page">
        <div class="sidebar">
            <NavMenu />
        </div>

        <main class="content px-4 py-3">
            @Body
        </main>
    </div>
}

<style>
    .page {
        display: flex;
        min-height: 100vh;
    }

    .sidebar {
        width: 250px;
    }

    .content {
        flex: 1;
    }
</style>

@code {
    private bool _authReady;

    protected override async Task OnInitializedAsync()
    {
        await ThemeService.InitializeAsync(JS);
        await Auth.InitializeAsync();
        _authReady = true;
    }
}
